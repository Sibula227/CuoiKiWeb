<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/layout :: head_fragment}"></head>

<body>
    <div th:replace="~{fragments/layout :: main_content(content=~{:: .admin-dashboard})}">
        
        <div class="admin-dashboard container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-dark">Dashboard Quản trị</h2>
                <button class="btn btn-light glass-card border-0 text-success fw-bold">
                    <i class="fa-solid fa-download me-2"></i> Xuất báo cáo
                </button>
            </div>

            <div class="row g-4 mb-5">
                <div class="col-md-4">
                    <div class="glass-card p-4 d-flex align-items-center text-primary">
                        <div class="bg-primary bg-opacity-10 p-3 rounded-4 me-3">
                            <i class="fa-solid fa-inbox fs-3"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted fw-bold">Tổng câu hỏi</p>
                            <h3 class="fw-bold mb-0" th:text="${questions.size()}">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="glass-card p-4 d-flex align-items-center text-warning">
                        <div class="bg-warning bg-opacity-10 p-3 rounded-4 me-3">
                            <i class="fa-regular fa-clock fs-3"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted fw-bold">Chờ xử lý</p>
                            <h3 class="fw-bold mb-0 text-warning" th:text="${pendingCount}">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="glass-card p-4 d-flex align-items-center text-success">
                        <div class="bg-success bg-opacity-10 p-3 rounded-4 me-3">
                            <i class="fa-solid fa-check-double fs-3"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted fw-bold">Đã hoàn thành</p>
                            <h3 class="fw-bold mb-0 text-success" th:text="${questions.size() - pendingCount}">0</h3>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-card p-4">
                <h5 class="fw-bold mb-4 text-success"><i class="fa-solid fa-list-ul me-2"></i>Danh sách yêu cầu</h5>
                
                <div class="table-responsive">
                    <table class="table table-hover align-middle" style="background: transparent;">
                        <thead class="bg-light text-muted">
                            <tr>
                                <th class="py-3 ps-3 rounded-start">Sinh viên</th>
                                <th class="py-3">Tiêu đề câu hỏi</th>
                                <th class="py-3">Phòng ban</th>
                                <th class="py-3">Trạng thái</th>
                                <th class="py-3">Ngày gửi</th>
                                <th class="py-3 rounded-end text-end pe-3">Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="q : ${questions}" class="border-bottom-0">
                                <td class="ps-3">
                                    <div class="d-flex align-items-center">
                                        <img th:src="${q.studentAvatar != null ? q.studentAvatar : 'https://ui-avatars.com/api/?name=' + q.studentName}" 
                                             class="rounded-circle me-2" width="35" height="35">
                                        <div>
                                            <div class="fw-bold text-dark" th:text="${q.studentName}">SV A</div>
                                            
                                            <small class="text-muted" style="font-size: 0.8rem;" th:if="${q.studentIdCode != null}">
                                                MSSV: <span th:text="${q.studentIdCode}"></span>
                                            </small>
                                            </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="d-block text-truncate fw-bold text-dark" style="max-width: 250px;" th:text="${q.title}">Tiêu đề</span>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark border" th:text="${q.departmentName}">Phòng Đào tạo</span>
                                </td>
                                <td>
                                    <span class="badge rounded-pill"
                                          th:classappend="${q.status.name() == 'ANSWERED'} ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'"
                                          th:text="${q.status.name() == 'ANSWERED' ? 'Đã trả lời' : 'Đang chờ'}">
                                    </span>
                                </td>
                                <td class="text-muted small" th:text="${q.timeAgo}">2 giờ trước</td>
                                <td class="text-end pe-3">
                                    <a th:href="@{/admin/question/{id}(id=${q.id})}" class="btn btn-sm btn-primary rounded-pill px-3 fw-bold">
                                        Xử lý <i class="fa-solid fa-arrow-right ms-1"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div th:if="${questions.isEmpty()}" class="text-center py-5">
                    <p class="text-muted">Chưa có dữ liệu câu hỏi nào.</p>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{fragments/layout :: script_fragment}"></div>
</body>
</html>